<!DOCTYPE html>
<html lang="en">

<head>
     <meta charset="UTF-8">
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Regresi√≥n lineal</title>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/p5.min.js"></script>
</head>

<body>

     <style>
          body,
          html {
               margin: 0;
               padding: 0;
          }
     </style>

     <table>
          <tbody>
               <tr>
                    <td>
                    </td>
                    <td>
                    </td>
               </tr>
          </tbody>
     </table>

     <script>

          ESCALA = 30
          TX = 0
          TY = 0

          function setup() {
               createCanvas(windowWidth, windowHeight / 2)
               TX = width * 0.2
               TY = height * 0.8
          }

          function windowResized() {
               resizeCanvas(windowWidth, windowHeight * 0.8)
          }

          function mouseDragged() {
               TX += mouseX - pmouseX
               TY += mouseY - pmouseY
          }

          function mouseWheel(event) {
               ESCALA += event.delta / 10
               ESCALA = constrain(ESCALA, 5, 200)
          }

          function draw() {
               background("lightgray")
               translate(TX, TY)
               if (keyIsDown(RIGHT_ARROW)) {
                    TX += 2
               }
               if (keyIsDown(LEFT_ARROW)) {
                    TX -= 2
               }
               if (keyIsDown(UP_ARROW)) {
                    TY -= 2
               }
               if (keyIsDown(DOWN_ARROW)) {
                    TY += 2
               }
               stroke("black")
               fill("black")
               line(-TX, 0, -TX + width, 0)
               line(0, -TY, 0, height - TY)

               let ymin = -ceil((height - TY) / ESCALA)
               let ymax = -floor(-TY / ESCALA)

               let coef_escala = ESCALA < 20 ? ESCALA < 10 ? 5 : 2 : 1

               textAlign(RIGHT, CENTER)

               for (let i = ymin; i <= ymax; i += coef_escala) {
                    let p = TL_point(0, i)
                    push()
                    noStroke()
                    circle(p.x, p.y, 5)
                    if (i != 0) {
                         text(int(-p.y / ESCALA), p.x - 15, p.y)
                    }
                    pop()
                    push()
                    stroke(0, 0, 0, 30)
                    if (i != 0) {
                         line(-TX, p.y, -TX + width, p.y)
                    }
                    pop()
               }
               xmin = floor(-TX / ESCALA)
               xmax = floor((width - TX) / ESCALA)
               for (let i = xmin; i <= xmax; i += coef_escala) {
                    let p = TL_point(i, 0)
                    push()
                    noStroke()
                    circle(p.x, p.y, 5)
                    if (i != 0) {
                         text(int(p.x / ESCALA), p.x, p.y + 15)
                    }
                    pop()
                    push()
                    stroke(0, 0, 0, 30)
                    if (i != 0) {
                         line(p.x, -TY, p.x, height - TY)
                    }
                    pop()
               }
               push()
               stroke("red")
               {
                    let pxmin = TL_point(xmin - 1, Fx(xmin - 1))
                    let pxmax = TL_point(xmax + 1, Fx(xmax + 1))
                    line(pxmin.x, pxmin.y, pxmax.x, pxmax.y)
               }
               pop()
               push()
               stroke("blue")
               for (const p of puntos_dispersos) {
                    let v = TL_point(p.x, p.y)
                    circle(v.x, v.y, 5)
               }
               pop()
          }

          function TL_point(x, y) {
               let v = createVector(x, y)
               v.mult(ESCALA, -ESCALA)
               return v
          }


          puntos_dispersos = []

          rm = Math.random() * 3 - 1.5
          rb = Math.random() * 5
          for (let x = Math.random(); x <= 20; x += Math.random()) {
               puntos_dispersos.push({ x, y: rm * x + rb + Math.random() * 4 - 2 })
          }

          function regresion_lineal() {
               let x = y = xy = xx = 0
               let cantidad = puntos_dispersos.length

               for (i = 0; i < cantidad; i++) {
                    x += puntos_dispersos[i].x;
                    y += puntos_dispersos[i].y;
                    xy += puntos_dispersos[i].x * puntos_dispersos[i].y;
                    xx += puntos_dispersos[i].x ** 2;
               }

               const b = ((cantidad * xy) - (x * y)) / ((cantidad * xx) - (x ** 2));

               const a = (y - (b * x)) / cantidad;

               return function (x) {
                    return a + b * x
               }
          }

          let Fx = regresion_lineal()

     </script>

</body>

</html>